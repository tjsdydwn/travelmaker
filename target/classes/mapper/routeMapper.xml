<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="routeSQL">

<<<<<<< HEAD
    <insert id="setRoute" parameterType="route">
        INSERT INTO route (bno, rno, seq, title, fixed, is_domestic)
        VALUES (bno.nextval, rno.nextval, #{seq}, #{title, jdbcType=VARCHAR}, 0, #{isDomestic})
    </insert>

    <update id="saveRoute" parameterType="route">
        begin
            UPDATE route
            SET content=#{content},
                hashtag=#{hashtag},
                date_write=SYSDATE,
                date_update=SYSDATE,
                fixed=1
            where rno = #{rno}
              and seq = #{seq};
            UPDATE route_content SET fixed=1 WHERE rno = #{rno};
        end;
    </update>

    <select id="getRoute" parameterType="Integer" resultType="route">
        SELECT *
        FROM route
        WHERE rno = #{rno}
    </select>

    <select id="getCurrRnoSeq" resultType="Integer">
        SELECT rno.CURRVAL
        FROM DUAL
    </select>

    <insert id="saveCourse" parameterType="routeContent">
        INSERT INTO route_content (crno, rno, content, lat, lng, location, date_start, date_end, score, fixed)
        VALUES (crno.NEXTVAL, #{rno}, #{content}, #{lat}, #{lng}, #{location},
                TO_DATE('${dateStart}', 'YYYY-MM-DD'), TO_DATE('${dateEnd}', 'YYYY-MM-DD'), #{score}, 0)
    </insert>

    <select id="getCurrCrnoSeq" resultType="Integer">
        SELECT crno.CURRVAL
        FROM DUAL
    </select>

<!--    <update id="updateCourse" parameterType="routeContent">-->
<!--        UPDATE route_content-->
<!--        SET (rno, content, lat, lng, location, date_start, date_end, score, fixed)-->
<!--        VALUES-->
<!--        (#{rno}, #{content}, #{lat}, #{lng}, #{location}, TO_DATE('${dateStart}','YYYY-MM-DD'), TO_DATE('${dateEnd}','YYYY-MM-DD'), #{score}, #{fixed})-->
<!--    </update>-->

    <insert id="saveRouteImage" parameterType="routeImage">
        INSERT INTO route_image
        VALUES (ino.nextVal, #{crno}, #{img}, #{imgOrder})
    </insert>

=======
	<insert id="setRoute" parameterType="route">
		INSERT INTO route (bno, rno, seq, title, fixed, is_domestic)
		VALUES (seq_bno.NEXTVAL, seq_rno.NEXTVAL, #{seq}, #{title}, 0, #{isDomestic})
	</insert>
	
	<update id="saveRoute" parameterType="route">
	begin
		UPDATE route SET content=#{content}, hashtag=#{hashtag}, date_write=SYSDATE, date_update=SYSDATE, fixed=1 where rno = #{rno} and seq = #{seq};
		UPDATE route_content SET fixed=1 WHERE rno=#{rno};
	end;
	</update>
	
	<select id="getRoute" parameterType="Integer" resultType="route" >
		SELECT * FROM route WHERE rno = #{rno}
	</select>
	
	<select id="getCurrRnoSeq" resultType="Integer">
		SELECT SEQ_RNO.CURRVAL FROM DUAL
	</select>
	
	<insert id="saveCourse" parameterType="routeContent">
		INSERT INTO route_content (crno, rno, content, lat, lng, location, date_start, date_end, score, fixed)
		VALUES (seq_crno.NEXTVAL, #{rno}, #{content}, #{lat}, #{lng}, #{location}, TO_DATE('${dateStart}','YYYY-MM-DD'), TO_DATE('${dateEnd}','YYYY-MM-DD'), #{score}, 0)
	</insert>

	<select id="getCurrCrnoSeq" resultType="Integer">
		SELECT SEQ_CRNO.CURRVAL FROM DUAL
	</select>
	
	<update id="updateCourse" parameterType="routeContent">
		UPDATE route_content SET (rno, content, lat, lng, location, date_start, date_end, score, fixed)
		VALUES (#{rno}, #{content}, #{lat}, #{lng}, #{location}, TO_DATE('${dateStart}','YYYY-MM-DD'), TO_DATE('${dateEnd}','YYYY-MM-DD'), #{score}, #{fixed})
	</update>
	
	<insert id="saveRouteImage" parameterType="routeImage">
		INSERT INTO route_image VALUES (seq_ino.NEXTVAL, #{crno}, #{img}, #{imgOrder})
	</insert>
	
>>>>>>> 586671ae114d8b2a9c3d6a1660afc4ea93908b98
</mapper>